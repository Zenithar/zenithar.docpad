<!DOCTYPE html><html lang="fr"><head><!--Meta--><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta http-equiv="content-type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Zenithar.org - Backbone.js - Présentation</title><meta name="description" content="Ancien ingénieur sécurité passionné, acteur dans le monde du logiciel 'libre'. Je suis en veille technologique permanente car toujours à la recherche du 'meilleur tournevis'." /><meta name="keywords" content="zenithar, toulouse, java, security, engineer, backbone.js, node.js, tutorial" /><meta name="author" content="Thibault NORMAND" /><!--Icons--><link rel="shortcut icon" href="images/favicon.ico" /><link rel="apple-touch-icon" href="images/apple-touch-icon.png" /><link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" /><link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" /><link rel="alternate" type="application/atom+xml" title="Zenithar.org &raquo; Feed" href="http://feeds.feedburner.com/ZenitharOrg" /><!--Shims: IE6-8 support of HTML5 elements--><!--[if lt IE 9]>
        <script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><!--Styles--><link rel="stylesheet" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" media="screen, projection" /><link rel="stylesheet" href="/styles/style.css" media="screen, projection" /><link rel="stylesheet" href="/styles/markdown.css" media="screen, projection" /><link rel="stylesheet" href="http://yandex.st/highlightjs/7.3/styles/github.min.css" media="screen, projection" /><!--Scripts--><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script><script src="//connect.facebook.net/fr_FR/all.js#xfbml=1"></script><script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.2.2/bootstrap.min.js"></script></head><body><!--Topbar--><div class="navbar navbar-static-top"><div class="navbar-inner"><div class="container"><a class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a class="brand" href="/">Zenithar.org</a><div class="nav-collapse collapse"><ul class="nav"><li><a href="/site/tagmap.html">Tagmap</a></li><li><a href="/site/archive.html">Archives</a></li><li><a href="http://zenithar.org" rel="me">CV</a></li><li><a href="http://feeds.feedburner.com/ZenitharOrg"><img src="/images/rss_32.png" style="width: 24px" /></a></li></ul><form id="search-form" class="pull-right navbar-search" action="http://google.com/search" method="get"><input type="hidden" name="q" value="site:www.zenithar.org" /><input type="text" name="q" results="0" placeholder="Search" search-query /></form></div></div></div></div><!--Markup--><div class="container"><div><script src="http://platform.twitter.com/widgets.js"></script><script>//facebook
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

//google plusone
(function() {
  var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
  po.src = 'https://apis.google.com/js/plusone.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
</script><section class="content"><article id="post" class="post" typeof="sioc:post" about="/articles/2012-03-04-backbone-dot-js-presentation.html" lang="fr-fr"><div class="row"><div class="span2 muted modern-font small-font"><span property="dc:created">2012 mars 04 &raquo;</span></div><div class="span10"><h1 property="dcterms:title">Backbone.js - Présentation</h1></div></div><div class="row"><div class="offset2 span10 modern-font small-font muted"><span>&nbsp; par <a href="https://twitter.com/zenithar/">Thibault NORMAND</a></span>
 | <a href="/site/tagmap.html#backbone.js" class="tag">backbone.js</a> <a href="/site/tagmap.html#node.js" class="tag">node.js</a> <a href="/site/tagmap.html#tutorial" class="tag">tutorial</a> | <span><a href="/articles/2012-03-04-backbone-dot-js-presentation.html#disqus_thread" data-disqus-identifier="/articles/2012-03-04-backbone-dot-js-presentation.html"></a></span>
</div></div><div class="row"><div class="span2"><style rel="stylesheet" media="screen, projection" scoped="scoped">#social-buttons {
  margin-left: 30px;
}</style><div id="social-buttons" class="pull-right"><ul class="unstyled"><li><a class="twitter-share-button" href="https://twitter.com/share" data-url="http://www.zenithar.org/articles/2012-03-04-backbone-dot-js-presentation.html" data-via="zenithar" data-count="horizontal" data-lang="fr">Tweet</a></li><li><div class="g-plusone" data-size="medium" data-href="http://www.zenithar.org/articles/2012-03-04-backbone-dot-js-presentation.html"></div></li><li><div class="fb-like" data-href="http://www.zenithar.org/articles/2012-03-04-backbone-dot-js-presentation.html" data-send="false" data-layout="button_count" data-show-faces="false"></div></li></ul></div></div><div class="span10"><div property="sioc:content"><h2>Introduction</h2>

<p>Cet article s'adresse aux personnes désirants découvrir ou redécouvrir, l'utilité et l'utilisation de <a href="http://documentcloud.github.com/backbone/">Backbone.JS</a> au sein d'une application Web Javascript. En effet <a href="http://documentcloud.github.com/backbone/">Backbone.JS</a> s'inscrit dans les technologies Javascript clientes (puisqu'il existe aussi un coté serveur via <a href="http://nodejs.org">Node.js</a>).</p>

<h2>Les concepts</h2>

<p>Chaque concept est implémenté en Javascript de telle sorte qu'ensemble ils forment votre application.</p>

<h3>Les modèles</h3>

<p>Les modèles <a href="http://documentcloud.github.com/backbone/">Backbone</a> sont des objets Javascript servant à représenter l'information, qui sera souvant utilisée pour l'affichage.</p>

<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> Person = Backbone.Model.extend({
    <span class="comment">// Déclaration des attributs de la classe MonModel</span>
    defaults : {
        firstname : <span class="literal">null</span>,
        lastname : <span class="literal">null</span>
    }
});
<span class="comment">// Pour utiliser le modèle </span>
<span class="keyword">var</span> tno = <span class="keyword">new</span> Person({firstname: <span class="string">"Thibaud"</span>, lastname: <span class="string">"Normand"</span>});
console.log(tno.get(<span class="string">"firstname"</span>));  <span class="comment">// "Thibaud"</span>
tno.set({firstname: <span class="string">"Thibaud"</span>});
console.log(tno.get(<span class="string">"firstname"</span>)); <span class="comment">// "Thibault"</span>
</code></pre>

<h3>Les collections</h3>

<p>Les collections sont des ensembles d'objets, en général d'un même type de modêle.</p>

<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> PersonCollection = Backbone.Collection.extend({
    <span class="comment">// C'est une collection d'object de type Personne</span>
    model: Person
});
<span class="comment">// Utilisation</span>
<span class="keyword">var</span> collection = <span class="keyword">new</span> PersonCollection();
collection.add(<span class="keyword">new</span> Person({<span class="string">"firstname"</span>: <span class="string">"toto"</span>, <span class="string">"lastname"</span>: <span class="string">"fait du vélo !"</span>}));
<span class="comment">// Mais aussi …</span>
<span class="keyword">var</span> collection2 = <span class="keyword">new</span> PersonCollection(
    [
        {id: <span class="string">"toto"</span>, <span class="string">"firstname"</span>: <span class="string">"toto"</span>, <span class="string">"lastname"</span>: <span class="string">"fait du vélo !"</span>},
        {id: <span class="string">"tutu"</span>, <span class="string">"firstname"</span>: <span class="string">"tutu"</span>, <span class="string">"lastname"</span>: <span class="string">"fait du vélo !"</span>}
    ]
);
</code></pre>

<p>Remarquez que j'ai ajouté un attribut <em>id</em> au modèle lorsque j'ai initialisé ma collection. Cela permet à Backbone.JS de ne pas générer un code, mais de le définir, pour pouvoir ensuite utilser la méthode suivante :</p>

<pre class="highlighted"><code class="javascript">collection2.get(<span class="string">"toto"</span>); <span class="comment">// Retourne l'objet Person avec l'id "toto"</span>
</code></pre>

<h3>Les vues</h3>

<p>Les vues sont utilisées pour représenter graphiquement (HTML, <a href="http://jquery.com/">jQuery</a> / <a href="http://zeptojs.com/">Zepto</a>) les informations issues d'un modèle ou d'une collection. C'est l'IHM du modèle ou de la collection associée.</p>

<pre class="highlighted"><code class="undefined">var PersonDetailsView = Backbone.View.extend({
    // Ici on utilise un selecteur CSS3, pour indiquer le point d'insertion 
    // de la vue dans l'arbre DOM. (On recherche un élément dont l'id est "details")
    el: $("#details"),
  // Ici on compile le template, cela utilise la fonction template d'underscore.js
  template: _.template("
    Hello &lt;%= firstname %&gt; &lt;%= lastname %&gt; ! 
  "),
    render: function() {
        this.el.append(this.template(this.model.toJSON()));
    }    
});
</code></pre>

<p>Il est important de retenir que les vues sont du codes Javascript qui va modifier la page courante (arbre DOM). Il est de ce fait très facile de contruire des vues qui sont complètement décorréllées de la page ou elle va être &ldquo;rendue&rdquo; (affichée). J'utilise la fonction de <a href="http://documentcloud.github.com/underscore/#template">template</a> Underscore.js.</p>

<p>Il est tout à fait possible d'utiliser d'autres moteurs de template, par exemple :</p>

<ul>
<li><a href="http://mustache.github.com/">Mustache.js</a></li>
<li><a href="http://twitter.github.com/hogan.js/">Hogan.js</a> (qui s'inspire de mustache &hellip; appréciez le jeu de mot &hellip; indice: hulk)</li>
<li><a href="http://handlebarsjs.com/">Handlebar.js</a></li>
<li>et bien d'autres &hellip;</li>
</ul>

<h3>Les routeurs</h3>

<p>Les routeurs sont utilisés pour diriger les appels provenant de l'extérieur, vers le bon code Javascript associé à l'url.</p>

<p>En effet, les routeurs utilisent une partie spéciale de l'URL, que l'on nomme le hashbang</p>

<pre class="highlighted"><code class="avrasm"><span class="label">http:</span>//www<span class="preprocessor">.zenithar</span><span class="preprocessor">.org</span>/index<span class="preprocessor">.html</span><span class="preprocessor">#!/person/toto</span>
</code></pre>

<table class="inpost">
    <thead>
        <tr>
            <th>Extrait</th><th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>&ldquo;http://&rdquo;</td><td>le protocole</td>
        </tr>
        <tr>
            <td>&ldquo;www&rdquo;</td><td>l'hôte</td>
        </tr>
        <tr>
            <td>&ldquo;index.html&rdquo;</td><td>la ressource</td>
        </tr>
        <tr>
            <td>&ldquo;#!/person/toto&rdquo;</td><td>le hasbang</td>
        </tr>
    </tbody>
</table>

<p>Ce hasbang était historiquement utilisé pour atteindre des ancres dans la page HTML, mais il peut aussi être utilisé via Javascript pour définir des comportements, et surtout les changements sont stockés dans l'historique de votre navigateur.</p>

<p>Par exemple, ici le hasbang peut très bien faire appel à la vue PersonneDetailsView, en utilisant l'objet Personne ayant pour code &ldquo;toto&rdquo;. </p>

<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> ApplicationRouter = Backbone.Router.extend({
    routes : {
        <span class="string">"!/person/:code"</span> : showPerson,
        <span class="string">""</span>: index
    },
    initialize: <span class="keyword">function</span>() {
        <span class="keyword">this</span>.detailsView = <span class="keyword">new</span> PersonDetailsView();
        <span class="keyword">this</span>.collection = <span class="keyword">new</span> PersonCollection();
    },
    showPerson : <span class="keyword">function</span>(code) {
        <span class="keyword">this</span>.detailsView.model = <span class="keyword">this</span>.collection.get(code);
        <span class="keyword">this</span>.detailsView.render();
    },
    index : <span class="keyword">function</span>() {
        $(<span class="string">"#details"</span>).hide();
    }
});
<span class="comment">// Initialisation</span>
<span class="keyword">var</span> router = <span class="keyword">new</span> ApplicationRouter();
<span class="comment">// Mise en place de l'écoute de changement de hashbang, et dispatch des routes.</span>
Backbone.history.start();
</code></pre>

<h3>Et les contrôleurs ?</h3>

<p>Si vous avez compris, c'est un modèle de conception MVC. Cependant le &lsquo;C&rsquo; de MVC, n'est pas clairement représenté dans Backbone.JS, en effet il y a les &lsquo;V'ues, les &rsquo;M'odêles, mais pas (plus) de Contrôleurs.</p>

<p>Pour être propre, il fortement conseiller d'utiliser un objet Javascript contenant les interactions entre Modêles / Collections / Vues, et de faire en sorte que les Routers utilisent le contrôleur. </p>

<pre class="highlighted"><code class="javascript"><span class="comment">// On crée ici un singleton Javascript.</span>
<span class="keyword">var</span> PersonController = (<span class="keyword">function</span>() {
    <span class="comment">// Sera initialisé à la création du singleton</span>
    <span class="comment">// Fait office de code privé</span>
    <span class="keyword">var</span> collection = <span class="keyword">new</span> PersonCollection();
    <span class="keyword">var</span> view = <span class="keyword">new</span> PersonDetailsView();
    <span class="keyword">return</span> {
        <span class="comment">// Code public exposé par le contrôleur</span>
        <span class="keyword">this</span>.showPerson: <span class="keyword">function</span>(code) {
            <span class="keyword">var</span> m = collection.get(code);
            view.model = m;
            view.render();
        }
    }
})();
<span class="comment">// De ce fait le code du router devient</span>
...
    showPerson : <span class="keyword">function</span>(code) {
        PersonController.showPerson(code);
    }
...
</code></pre>

<h3>Communication</h3>

<p>La communication de Backbone.JS avec le serveur se fait par l'intermédiaire d'une méthode &ldquo;Backbone.sync&rdquo;, cette méthode va définir les comportements à adopter en fonction de l'opération élémentaire à réaliser.</p>

<p>Par défaut, Backbone.JS utilise un mode de communication via des services type REST :</p>

<table class="inpost">
    <thead>
        <tr>
            <th>URL</th><th>Verbe HTTP</th><th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>/collections</td><td><b>GET</b></td><td>Récupèration de la liste des objets</td>
        </tr>
        <tr>
            <td>/collections</td><td><b>POST</b></td><td>Création d'un objet</td>
        <tr>
            <td>/collections/id</td><td><b>PUT</b></td><td>Mise à jour de l'objet</td>
        </tr>
        <tr>
            <td>/collections/id</td><td><b>DELETE</b></td><td>Suppression de l'objet</td>
        </tr>
    </tbody>
</table>

<p>C'est à dire qu'il vous faudra concevoir des services coté serveur pour pouvoir stocker les modifications coté client, via les services <a href="http://fr.wikipedia.org/wiki/Representational_State_Transfer">REST</a>.</p>

<p>Par exemple :</p>

<pre class="highlighted"><code class="javascript"><span class="keyword">var</span> RemotePersonCollection = Backbone.Collection.extend({
    <span class="comment">// C'est une collection d'object de type Personne</span>
    model: Person,
    <span class="comment">// On ajoute l'information nécessaire à Bacbone.sync pour le chargement </span>
    <span class="comment">// de la collection, le format de retour devra être conforme au JSON du </span>
    <span class="comment">// modèle</span>
    url: <span class="string">"/api/persons"</span>
});
<span class="comment">// Utilisation</span>
<span class="keyword">var</span> remoteCollection = <span class="keyword">new</span> RemotePersonCollection();
remoteCollection.fetch(); 
<span class="comment">// Execute un appel Ajax qui va retourner une liste de personne.</span>
<span class="comment">// L'utilisation de la collection est comme en locale.</span>
<span class="keyword">var</span> m = remoteCollection.get(<span class="string">'toto'</span>); 
<span class="comment">// Modification de l'objet de la collection</span>
m.set({<span class="string">"firstname"</span>:<span class="string">"dudu"</span>});
m.save(); <span class="comment">// Requête PUT '/api/persons/toto'</span>
</code></pre>

<h2>En attendant la suite</h2>

<p>Bon voila pour le moment, j'espère pas vous avoir perdu. Au menu du prochain article, la programmation asynchrone, les évènements Backbone.JS, les tests unitaires, <a href="http://coffeescript.org/">CoffeeScript</a>, et enfin le désossement de l'application phare Backbone.JS la TODO App.</p>

<p>Je vous invite à aller lire le livre qui est en train d'être écrit par <a href="http://addyosmani.com/">Addy Osmani</a></p>

<ul>
<li><a href="http://addyosmani.com/blog/backbone-fundamentals/">Backbone Fundamentals – A Free Work-In-Progress Book For Developers Of All Levels</a></li>
</ul>

<p>PS : Vive Markdown, et <a href="http://mouapp.com/">Mou</a> <sup>^</sup></p>
</div></div></div></article></section><section id="related"><div class="row"><div class="offset2 span10"><h3>Autre(s) article(s)</h3><ul><li><span>2012 mars 05</span>&nbsp;&raquo;&nbsp;<a href="/articles/2012-03-05-backbone-dot-js-les-evenements.html">Backbone.js - Les évènements</a></li><li><span>2012 avr. 07</span>&nbsp;&raquo;&nbsp;<a href="/articles/2012-04-07-backbone-dot-js-and-coffeescript.html">Backbone.js &amp; CoffeeScript</a></li></ul></div></div></section><section id="comments"><div class="row"><div class="offset2 span10"><h3>Commentaire(s)</h3><div id="disqus_thread" class="well"></div>
<script type="text/javascript">
    var disqus_shortname = 'zenithar';
    var disqus_identifier = '/articles/2012-03-04-backbone-dot-js-presentation.html';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></section></div></div><footer class="footer"><div class="container"><div class="row"><p>Copyright &copy; 2005-2013 Thibault NORMAND, motorisé par <a href="https://github.com/balupton/docpad">Docpad</a>, versionné par <a href="https://github.com/Zenithar/zenithar.docpad">Github</a>.</p></div></div></footer><!--DISQUS--><script>var disqus_shortname = 'zenithar';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());</script><!--GA--><script>if( 'http://www.zenithar.org' === 'http://' + window.location.hostname ) {
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8114245-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}</script></body></html>